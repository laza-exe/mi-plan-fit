<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Plan Semanal</title>
    <link href="https://fonts.googleapis.com/css?family=Inter:400,600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f8f9fa;
            --card: #ffffff;
            --primary: #7ba4c4;
            --accent: #aac6b8;
            --text: #333333;
            --danger: #dc3545;
            --border: #e0e0e0; /* Nuevo para consistencia con index.html */
            --input-bg: #ffffff; /* Nuevo para consistencia con index.html */
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --font-family: 'Inter', sans-serif;
        }
        body.dark-mode { /* Añadido para que editar_dias también respete el modo oscuro */
            --bg: #1a1a2e;
            --card: #20203a;
            --primary: #8aafff;
            --accent: #5e8b7e;
            --text: #e0e0e0;
            --danger: #f44336;
            --border: #44445c;
            --input-bg: #2a2a40;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--card);
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        h1, h2 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
        }

        h2 {
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
            margin-top: 30px;
        }

        .section {
            margin-bottom: 25px;
            padding: 15px;
            background-color: var(--bg);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }

        input[type="text"],
        select {
            width: calc(100% - 20px);
            padding: 12px 10px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: var(--text);
            font-family: var(--font-family);
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        select:focus {
            border-color: var(--primary);
            outline: none;
        }

        button {
            background-color: var(--primary);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s ease;
            display: inline-block;
            width: auto;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            background-color: #6a95b5;
        }

        button.danger {
            background-color: var(--danger);
        }

        button.danger:hover {
            background-color: #c82333;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .day-section {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .day-card {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            flex: 1 1 calc(50% - 15px); /* Dos columnas en pantallas grandes */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            min-width: 280px; /* Ancho mínimo para evitar encogimiento excesivo */
        }

        .day-card h3 {
            color: var(--accent);
            margin-top: 0;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 5px;
        }

        .day-card ul {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .day-card li {
            background-color: var(--bg);
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 8px 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95em;
        }

        .day-card li button {
            padding: 5px 10px;
            font-size: 0.85rem;
            margin-left: 10px;
            margin-bottom: 0;
        }

        .master-exercise-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }

        .master-exercise-list li {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            button {
                width: 100%;
                margin-right: 0;
            }
            .button-group {
                flex-direction: column;
                align-items: stretch;
            }
            .day-card {
                flex: 1 1 100%; /* Una columna en pantallas pequeñas */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Editar Plan Semanal</h1>

        <div class="section">
            <h2>Plan de Entrenamiento por Días</h2>
            <div class="day-selection-controls">
                <label for="daySelect">Seleccionar Día:</label>
                <select id="daySelect">
                    <option value="day-1">Día 1 - Lunes</option>
                    <option value="day-2">Día 2 - Martes</option>
                    <option value="day-3">Día 3 - Miércoles</option>
                    <option value="day-4">Día 4 - Jueves</option>
                    <option value="day-5">Día 5 - Viernes</option>
                    <option value="day-6">Día 6 - Sábado</option>
                    <option value="day-7">Día 7 - Domingo</option>
                </select>
                <label for="dayNameInput">Nombre del Día:</label>
                <input type="text" id="dayNameInput" placeholder="Ej. Día 1 - Full Body Fuerza">
                <button id="saveDayNameBtn">Guardar Nombre del Día</button>
            </div>

            <h3>Ejercicios para <span id="currentEditingDayName">Día 1 - Full Body Fuerza</span>:</h3>
            <div class="form-group">
                <label for="addExerciseToDaySelect">Añadir ejercicio al día:</label>
                <select id="addExerciseToDaySelect">
                    </select>
                <button id="addExerciseToDayBtn">Añadir al Día</button>
            </div>
            <ul id="dayExercisesList">
                </ul>
        </div>

        <div class="section">
            <h2>Gestión de Ejercicios Maestros</h2>
            <div class="form-group">
                <label for="newMasterExercise">Nuevo Ejercicio Maestro:</label>
                <input type="text" id="newMasterExercise" placeholder="Ej. Press Militar">
                <button id="addMasterExerciseBtn">Añadir a Lista Maestra</button>
            </div>
            <h3>Lista Maestra de Ejercicios:</h3>
            <ul id="masterExerciseList" class="master-exercise-list">
                </ul>
        </div>

        <div class="button-group">
            <button onclick="window.location.href='index.html'">Volver al Inicio</button>
        </div>
    </div>

    <script>
        // --- Variables Globales ---
        let planEntrenamiento = {}; // Almacena el plan de entrenamiento semanal
        let masterExercises = []; // Lista maestra de todos los ejercicios disponibles

        // --- Selectores DOM ---
        const daySelect = document.getElementById('daySelect');
        const dayNameInput = document.getElementById('dayNameInput');
        const saveDayNameBtn = document.getElementById('saveDayNameBtn');
        const currentEditingDayName = document.getElementById('currentEditingDayName');
        const addExerciseToDaySelect = document.getElementById('addExerciseToDaySelect');
        const addExerciseToDayBtn = document.getElementById('addExerciseToDayBtn');
        const dayExercisesList = document.getElementById('dayExercisesList');
        const newMasterExerciseInput = document.getElementById('newMasterExercise');
        const addMasterExerciseBtn = document.getElementById('addMasterExerciseBtn');
        const masterExerciseList = document.getElementById('masterExerciseList');

        // --- Funciones de Utilidad ---

        // Guardar plan de entrenamiento en localStorage
        function savePlan() {
            localStorage.setItem("planEntrenamiento", JSON.stringify(planEntrenamiento));
            console.log("Plan de entrenamiento guardado:", planEntrenamiento);
        }

        // Guardar lista maestra de ejercicios en localStorage
        function saveMasterExercises() {
            localStorage.setItem("master_exercises", JSON.stringify(masterExercises));
            console.log("Ejercicios maestros guardados:", masterExercises);
        }

        // Aplicar modo oscuro al cargar
        function applyDarkMode() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
        }

        // --- Funciones para la Edición del Plan Semanal ---

        // Cargar el plan de entrenamiento y ejercicios maestros
        function loadData() {
            planEntrenamiento = JSON.parse(localStorage.getItem("planEntrenamiento") || "{}");
            masterExercises = JSON.parse(localStorage.getItem("master_exercises") || "[]");

            // Valores por defecto para el plan de entrenamiento si no existe
            if (Object.keys(planEntrenamiento).length === 0) {
                planEntrenamiento['day-1'] = { name: "Día 1 - Full Body Fuerza", ejercicios: ["Peso muerto rumano", "Dominadas asistidas", "Press inclinado", "Plancha", "Bird-dogs"] };
                planEntrenamiento['day-2'] = { name: "Día 2 - Hipertrofia + Core", ejercicios: ["Sentadilla goblet", "Remo con barra", "Z-Press", "Plancha reach", "Hollow hold"] };
                planEntrenamiento['day-3'] = { name: "Día 3 - Cardio + Core", ejercicios: ["Caminata inclinada", "2 abdominales a elección", "Movilidad 10 min"] };
                planEntrenamiento['day-4'] = { name: "Día 4 - Descanso", ejercicios: [] };
                planEntrenamiento['day-5'] = { name: "Día 5 - Tren Superior", ejercicios: ["Press de hombros", "Remo con mancuernas", "Flexiones"] };
                planEntrenamiento['day-6'] = { name: "Día 6 - Tren Inferior", ejercicios: ["Sentadilla", "Peso muerto", "Zancadas"] };
                planEntrenamiento['day-7'] = { name: "Día 7 - Actividad Ligera", ejercicios: ["Yoga", "Caminata"] };
                savePlan();
            }

            // Valores por defecto para el listado maestro si no existe o está vacío
            if (masterExercises.length === 0) {
                masterExercises = [
                    "Sentadilla", "Peso Muerto", "Press Banca", "Press Militar", "Remo con Barra",
                    "Dominadas", "Fondos", "Curl de Bíceps", "Extensión de Tríceps", "Press Inclinado",
                    "Sentadilla Goblet", "Zancadas", "Prensa de Piernas", "Extensiones de Cuádriceps",
                    "Curl Femoral", "Elevaciones Laterales", "Pájaros", "Face Pull", "Plancha",
                    "Crunch", "Elevación de Piernas", "Hollow Hold", "Bird-dog", "Caminata Inclinada",
                    "Burpees", "Saltos de Caja", "Sentadilla Búlgara", "Hip Thrust", "Press Francés"
                ].sort(); // Asegurarse de que esté ordenado
                saveMasterExercises();
            }
        }

        // Rellenar el selector de ejercicios maestros
        function populateMasterExerciseSelect() {
            addExerciseToDaySelect.innerHTML = '';
            masterExercises.forEach(exercise => {
                const option = document.createElement('option');
                option.value = exercise;
                option.textContent = exercise;
                addExerciseToDaySelect.appendChild(option);
            });
        }

        // Mostrar los ejercicios del día seleccionado
        function displayDayExercises() {
            const selectedDayKey = daySelect.value;
            const dayPlan = planEntrenamiento[selectedDayKey];

            currentEditingDayName.textContent = dayPlan ? dayPlan.name : `Día ${selectedDayKey.split('-')[1]}`;
            dayNameInput.value = dayPlan ? dayPlan.name : '';

            dayExercisesList.innerHTML = ''; // Limpiar lista
            if (dayPlan && dayPlan.ejercicios && dayPlan.ejercicios.length > 0) {
                dayPlan.ejercicios.forEach((exercise, index) => {
                    const li = document.createElement('li');
                    li.textContent = exercise;
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'Eliminar';
                    deleteBtn.classList.add('danger');
                    deleteBtn.onclick = () => removeExerciseFromDay(selectedDayKey, index);
                    li.appendChild(deleteBtn);
                    dayExercisesList.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = 'No hay ejercicios para este día. Añade algunos desde la lista maestra.';
                dayExercisesList.appendChild(li);
            }
        }

        // Añadir ejercicio al día seleccionado
        addExerciseToDayBtn.addEventListener('click', () => {
            const selectedDayKey = daySelect.value;
            const exerciseToAdd = addExerciseToDaySelect.value;

            if (exerciseToAdd && planEntrenamiento[selectedDayKey]) {
                if (!planEntrenamiento[selectedDayKey].ejercicios) {
                    planEntrenamiento[selectedDayKey].ejercicios = [];
                }
                if (!planEntrenamiento[selectedDayKey].ejercicios.includes(exerciseToAdd)) {
                    planEntrenamiento[selectedDayKey].ejercicios.push(exerciseToAdd);
                    savePlan();
                    displayDayExercises();
                } else {
                    alert("Este ejercicio ya está en el día.");
                }
            } else if (!exerciseToAdd) {
                alert("Por favor, selecciona un ejercicio de la lista maestra para añadir.");
            }
        });

        // Eliminar ejercicio de un día
        function removeExerciseFromDay(dayKey, index) {
            if (planEntrenamiento[dayKey] && planEntrenamiento[dayKey].ejercicios) {
                planEntrenamiento[dayKey].ejercicios.splice(index, 1);
                savePlan();
                displayDayExercises();
            }
        }

        // Manejar cambio de día en el selector
        daySelect.addEventListener('change', displayDayExercises);

        // Guardar el nombre del día
        saveDayNameBtn.addEventListener('click', () => {
            const selectedDayKey = daySelect.value;
            const newName = dayNameInput.value.trim();
            if (newName) {
                if (!planEntrenamiento[selectedDayKey]) {
                    planEntrenamiento[selectedDayKey] = { ejercicios: [] }; // Asegurarse de que el objeto del día exista
                }
                planEntrenamiento[selectedDayKey].name = newName;
                savePlan();
                currentEditingDayName.textContent = newName; // Actualizar el display
                alert("Nombre del día guardado.");
            } else {
                alert("El nombre del día no puede estar vacío.");
            }
        });


        // --- Funciones para la Gestión de Ejercicios Maestros ---

        // Mostrar la lista maestra de ejercicios
        function displayMasterExercises() {
            masterExerciseList.innerHTML = '';
            masterExercises.forEach((exercise, index) => {
                const li = document.createElement('li');
                li.textContent = exercise;
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Eliminar';
                deleteBtn.classList.add('danger');
                deleteBtn.onclick = () => removeMasterExercise(index);
                li.appendChild(deleteBtn);
                masterExerciseList.appendChild(li);
            });
        }

        // Añadir nuevo ejercicio a la lista maestra
        addMasterExerciseBtn.addEventListener('click', () => {
            const newExercise = newMasterExerciseInput.value.trim();
            if (newExercise && !masterExercises.includes(newExercise)) {
                masterExercises.push(newExercise);
                masterExercises.sort(); // Mantener la lista ordenada
                saveMasterExercises();
                displayMasterExercises();
                populateMasterExerciseSelect(); // Actualizar el select de añadir al día
                newMasterExerciseInput.value = ''; // Limpiar el input
            } else if (!newExercise) {
                alert("El nombre del ejercicio no puede estar vacío.");
            } else {
                alert("Este ejercicio ya existe en la lista maestra.");
            }
        });

        // Eliminar ejercicio de la lista maestra
        function removeMasterExercise(index) {
            if (confirm(`¿Estás seguro de que quieres eliminar "${masterExercises[index]}" de la lista maestra?`)) {
                masterExercises.splice(index, 1);
                saveMasterExercises();
                displayMasterExercises();
                populateMasterExerciseSelect(); // Actualizar el select de añadir al día
            }
        }

        // --- Inicialización al Cargar la Página ---
        document.addEventListener('DOMContentLoaded', () => {
            applyDarkMode();
            loadData(); // Cargar plan y ejercicios maestros
            populateMasterExerciseSelect(); // Rellenar el select de añadir ejercicios
            displayMasterExercises(); // Mostrar la lista maestra
            displayDayExercises(); // Mostrar los ejercicios del primer día por defecto
        });
    </script>
</body>
</html>